### Маркетплейс - Step Two (JAVA with JDBC - console UI)

Необходимо обновить сервис, разработанный на первом шаге согласно следующим требованиям и ограничениям.

---
#### Требования и ограничения:

- Репозитории теперь должны писать ВСЕ сущности в БД PostgreSQL.
- Идентификаторы при сохранении в БД должны выдаваться через sequence.
- DDL-скрипты на создание таблиц и скрипты на предзаполнение таблиц должны выполняться только инструментом миграции Liquibase.
- Скрипты миграции Luiqbase должны быть написаны в нотации XML или YAML.
- Скриптов миграции должно быть несколько. Как минимум один на создание всех таблиц, другой - на предзаполнение данными.
- Служебные таблицы должны быть в отдельной схеме.
- Таблицы сущностей хранить в схеме public запрещено.
- В тестах необходимо использовать test-containers.
- В приложении должен быть docker-compose.yml, в котором должны быть прописаны инструкции для развертывания postgre в докере. Логин, пароль и база должны быть отличными от тех, что прописаны в образе по-умолчанию. Приложение должно работать с БД, развернутой в докере с указанными параметрами.
- Приложение должно поддерживать конфиг-файлы. Всё, что относится к подключению БД, а также к миграциям, должно быть сконфигурировано через конфиг-файл.

---
#### Вариант реализации:

**Стек:**
- Java 17
- Gradle 8.2.1
- JUnit 5
- Mockito
- AssertJ
- PostgreSQL 14
- Docker
- Liquibase
- JDBC
- Testcontainers

---
#### Структура проекта:

- [config](./src/main/java/me/oldboy/market/config) - папка содержит основные конфигурационные файлы приложения;
  - [ConnectionManager](./src/main/java/me/oldboy/market/config/connection/ConnectionManager.java) - класс соединения с БД (рабочий и тестовый тип соединения);
  - [ContextApp](./src/main/java/me/oldboy/market/config/context/ContextApp.java) - класс инициализирующий и связывающий основные рабочие части приложения;
  - [LiquibaseManager](./src/main/java/me/oldboy/market/config/liquibase/LiquibaseManager.java) - класс управляющий взаимодействием с миграционным фреймворком;
  - [utils](./src/main/java/me/oldboy/market/config/utils) - классы отвечающие за чтение данных из файла свойств [application.properties](./src/main/resources);
- [controllers](./src/main/java/me/oldboy/market/controlers) - набор классов отвечающих за получение запросов из меню и возвращающая данные для отображения информации либо сами отображения;
- [entity](./src/main/java/me/oldboy/market/entity) - ключевые сущности проекта;
- [exceptions](./src/main/java/me/oldboy/market/exceptions) - набор исключений бросаемых приложением в процессе работы;
- [repository](./src/main/java/me/oldboy/market/repository) - классы и методы взаимодействия со слоем данных; 
- [services](./src/main/java/me/oldboy/market/services) - классы основной бизнес логики;
- [validator](./src/main/java/me/oldboy/market/validator) - классы обрабатывающие неверное введение данных в консоли в ключевых точках приложения;
- [menu](./src/main/java/me/oldboy/market/menu) - классы и методы консольного взаимодействия с пользователем;
- [MainApp](./src/main/java/me/oldboy/market/MainApp.java) - точка входа в приложение;


- [docker-compose.yaml](docker-compose.yaml) - конфигурация сборки PastgreSQL контейнера;
- [.env](.env) - файл для хранения переменных окружения (в нашем случае доступ к БД);
---
- [Тесты](./src/test) - тесты, согласно расчетам IDE покрытие: Class - 95%, Method - 90%; 
- Полное покрытие JavaDoc.
---
#### Запуск и тестирование приложение:

Для сборки и запуска необходимо сделать локальную копию приложения.
- **Первый вариант** (наиболее простой и надежный для целей изучения и тестов): Запуск и тестирование проекта в среде разработки - IntelliJ IDEA

- **Второй вариант**: Консольный запуск приложения. 

Особенности консольного запуска приложения зависят от используемой ОС. Ниже приведено описание взаимодействие с приложением 
в консоли Win10. Необходимо помнить, что данный проект взаимодействует с PostgreSQL БД развернутой в отдельном контейнере, 
см. [docker-compose.yaml](docker-compose.yaml). Контейнер должен быть запущен и работать перед запуском приложения и его 
тестами, т.к. для проверки работоспособности слоев [repository](./src/test/java/me/oldboy/market/repository) и 
[services](./src/test/java/me/oldboy/market/services) используется функционал [Testcontainer-а](./src/test/java/me/oldboy/market/test_container).

**Шаг 1.** - (На машине должен быть установлен полнофункциональный Docker) В корне текущего проекта находится файл "инструкция"
сборки и запуска контейнера с БД - [docker-compose.yaml](docker-compose.yaml). Запускаем консоль и переходим в корень проекта,
запускаем команду:

    docker-compose up

Убеждаемся, что процесс развертки контейнера прошел нормально и контейнер запущен.

**Шаг 2.** - Запуск тестов. Из корня проекта в консоли передается команда:

    gradlew test

**Шаг 3.** - Сборка Jar файла. Из корня проекта в консоли передается команда:

    gradlew shadowJar

Если все прошло нормально, то в папке build/libs/ проекта появится файл market.jar

**Шаг 4.** - Запуск jar архива. Обычно хватает команды:

    java -Dfile.encoding=windows-1251 -jar build/libs/market.jar

или 

    java -jar build/libs/market.jar

однако!

---
#### Особенности

Разработка проекта велась под ОС Windows 10, даже после установки **file.encoding=UTF-8** в Gradle, консоль может
не отображать кириллицу корректно, так как по умолчанию использует другую кодировку (например, CP866). Для работы 
с приложением в консоли Windows нужно (более точные настройки работы приложения, зависят от настроек окружения вашей ОС).

Временно задаем кодовую страницу в терминале перед запуском Gradle:

    chcp 1251

и только затем:

    java -Dfile.encoding=windows-1251 -jar build/libs/market.jar

или

    java -jar build/libs/market.jar

Команда 'chcp 1251' устанавливает кодовую страницу для текущего сеанса консоли.

---
**Авторизация:**
- Логины: admin@admin.ru / user@user.ru / manager@manager.ru;
- Пароли: 1234 / 4321 / 1111;

---
#### Особенности

Техническое задание данного проекта не предусматривает возможность регистрации нового пользователя, ТОЛЬКО авторизация 
пользователя и все, судя по всему предполагается, что новые пользователи добавляются (и управляются) другим способом или
из другого сервиса приложения. Однако на слое репозиториев реализована и протестирована полная CRUD функциональность 
с управляемым просачиванием ее "на верхние слои приложения" не только для пользователей, но и для всех применяемых 
сущностей - "на перспективу". 

---
#### Взаимодействие с приложением

Согласно пунктам меню.

---
#### Работа над ошибками

- доработан функционал консольной валидации вводимых данных - повышена устойчивость меню (сохранена небольшая часть бросков исключений);
- переконфигурирован файл сборщика, добавлена проверка кодировки для Win консоли, переписана инструкция по консольному запуску приложения - при должной стартовой настройке приложения все данные корректно сохраняются, как в файл, так и в БД - текущая работа;